<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Happy Birthday!</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
            color: white;
            text-align: center;
            overflow-x: hidden;
            background: radial-gradient(#0d0221, #19062d);
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://www.transparenttextures.com/patterns/stardust.png');
            opacity: 0.3;
            z-index: -2;
            animation: twinkle 10s linear infinite;
        }

        @keyframes twinkle {
            0% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.6;
            }

            100% {
                opacity: 0.3;
            }
        }

        h1 {
            color: deeppink;
            font-size: 50px;
            margin-top: 30px;
        }

        p {
            font-size: 20px;
            color: #ffd6ff;
            margin: 10px 0 30px;
        }

        .carousel-background {
            margin: 0 auto;
            margin-top: 40px;
            padding: 30px 0;
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            height: 350px;
            position: relative;
            overflow: hidden;
        }

        .blurred-bg {
            position: absolute;
            top: -10px;
            left: -10px;
            width: calc(100% + 20px);
            height: calc(100% + 20px);
            background-size: cover;
            background-position: center;
            filter: blur(4px) brightness(1.4) contrast(1.1);
            z-index: 0;
            transition: background-image 1s ease-in-out;
        }




        .blurred-bg::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
        }

        .carousel-container::before {
            transform: scale(1.15);
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-position: center;
            background-size: cover;
            filter: blur(20px);
            z-index: -1;
        }


        .carousel {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s;
            position: relative;
        }

        .carousel img {
            position: absolute;
            width: 220px;
            height: 320px;
            object-fit: cover;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: transform 0.5s, opacity 0.5s;
            left: calc(50% - 110px);
            top: 15px;
        }

        #countdown-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            z-index: 9999;
        }

        #main-content {
            display: none;
        }

        #music-control {
            margin-top: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background: transparent;
            border: none;
            color: white;
        }

        .heart {
            position: fixed;
            color: #ff69b4;
            font-size: 20px;
            animation: float 4s linear infinite;
            z-index: 10;
            pointer-events: none;
        }

        @keyframes float {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(-100vh) scale(0.5);
                opacity: 0;
            }
        }

        .heart {
            position: fixed;
            will-change: transform, opacity;
            user-select: none;
        }

        @keyframes flyUp {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-120vh) translateX(calc(-20px + 40px * random()));
                opacity: 0;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.3);
            }
        }

        .balloon {
            position: fixed;
            bottom: -100px;
            font-size: 30px;
            animation: floatBalloon 6s linear forwards;
            z-index: 10;
            pointer-events: none;
        }

        @keyframes floatBalloon {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(-110vh) rotate(360deg);
                opacity: 0;
            }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: hsl(0, 100%, 50%);
            opacity: 0.8;
            z-index: 15;
            animation: fall 3s linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: hsl(0, 100%, 50%);
            opacity: 0.8;
            z-index: 15;
            animation: fall 3s linear forwards;
            pointer-events: none;
            border-radius: 50%;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div id="countdown-screen">
        <div id="countdown">5</div>
        <div style="font-size:0.4em; margin-top:10px;">üéâ Let's Begin the Celebration! üéâ</div>
    </div>

    <div id="main-content">
        <h1 class="typing">üéâ Happy Birthday, My Best Friend Amminiii.....! üéâ</h1>
        <p>Dear Best Friend,<br>Wishing you all the joy and happiness!</p>

        <audio id="bg-music" autoplay loop muted>
            <source src="{{ url_for('static', filename='music/happy_birthday.mp3') }}" type="audio/mpeg">
        </audio>
        <button id="music-control" title="Toggle Music">üéµ</button>

        <div class="countdown" id="live-countdown"></div>
        <div id="messages"></div>

        <div class="carousel-background" id="carousel-bg">
            <div class="blurred-bg" id="blurred"></div>
            <div class="carousel-container">
                <div class="carousel" id="carousel">
                    {% for image in images %}
                    <img src="{{ url_for('static', filename='images/' + image['file']) }}" alt="Slide">
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.9.1/dist/fireworks.js"></script>

    <script>
        // Countdown screen
        let counter = 5;
        const countdownDiv = document.getElementById("countdown");
        const countdownScreen = document.getElementById("countdown-screen");
        const mainContent = document.getElementById("main-content");

        const interval = setInterval(() => {
            counter--;
            countdownDiv.textContent = counter;
            if (counter === 0) {
                clearInterval(interval);
                countdownScreen.style.display = "none";
                mainContent.style.display = "block";
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                const fireworks = new Fireworks(document.body);
                fireworks.start();
            }
        }, 1000);

        // Birthday countdown

        // Messages
        const messages = [
            "You make every moment special ‚ù§Ô∏è",
            "May all your dreams come true ‚ú®",
            "You‚Äôre one in a million! üéÅ",
            "Enjoy your day to the fullest üéä",
            "Sending hugs and love üíñ"
        ];
        let msgIndex = 0;
        const msgBox = document.getElementById("messages");
        function showMessage() {
            msgBox.innerText = messages[msgIndex];
            msgIndex = (msgIndex + 1) % messages.length;
        }
        showMessage();
        setInterval(showMessage, 4000);

        // Carousel
        // Carousel
        const carousel = document.getElementById("carousel");
        const images = carousel.getElementsByTagName("img");
        const blurredBg = document.getElementById("blurred");
        const total = images.length;
        let angle = 0;
        let frontIndex = 0;

        // Calculate radius dynamically
        const imageWidth = 220;
        const radius = Math.round(imageWidth / Math.tan(Math.PI / total));

        function updateBackground(index) {
            blurredBg.style.backgroundImage = `url('${images[index].src}')`;
        }

        // Position each image in 3D space
        for (let i = 0; i < total; i++) {
            const theta = (360 / total) * i;
            images[i].style.transform = `rotateY(${theta}deg) translateZ(${radius}px)`;
        }

        function rotateCarousel() {
            frontIndex = (frontIndex + 1) % total;
            angle += 360 / total;
            carousel.style.transform = `rotateY(${angle}deg)`;
            updateBackground(frontIndex);
        }

        updateBackground(frontIndex);
        setInterval(rotateCarousel, 3000);


        // Music toggle
        const music = document.getElementById('bg-music');
        const button = document.getElementById('music-control');
        let musicStarted = false;

        button.addEventListener('click', () => {
            if (!musicStarted) {
                music.muted = false;
                music.play();
                musicStarted = true;
                button.textContent = "üîá";
            } else {
                if (music.paused) {
                    music.play();
                    button.textContent = "üîá";
                } else {
                    music.pause();
                    button.textContent = "üéµ";
                }
            }
        });

        // Unmute on click anywhere
        window.addEventListener("click", () => {
            if (!musicStarted) {
                music.muted = false;
                music.play();
                musicStarted = true;
                button.textContent = "üîá";
            }
        });
    </script>
    <script>
        function createHeart() {
            const heart = document.createElement("div");
            heart.className = "heart";
            heart.textContent = "‚ù§Ô∏è";
            heart.style.left = Math.random() * 100 + "vw";
            heart.style.fontSize = (20 + Math.random() * 20) + "px";
            document.body.appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, 4000);
        }

        setInterval(createHeart, 300);
    </script>
    <script>
        const heartEmojis = ["üíñ", "üíï", "üíó", "üíò", "‚ù§Ô∏è", "üß°", "üíõ", "üíö", "üíô", "üíú"];

        function createHeart() {
            const heart = document.createElement("div");
            heart.className = "heart";
            heart.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];

            const size = 20 + Math.random() * 30;
            heart.style.fontSize = size + "px";
            heart.style.color = `hsl(${Math.random() * 360}, 100%, 70%)`;

            heart.style.left = Math.random() * 100 + "vw";
            heart.style.top = "100vh";
            heart.style.position = "fixed";
            heart.style.zIndex = 10;
            heart.style.opacity = 1;
            heart.style.pointerEvents = "none";
            heart.style.animation = "flyUp 4s linear forwards, pulse 1s ease-in-out infinite";

            document.body.appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, 4000);
        }

        setInterval(createHeart, 300);
    </script>
    <script>
        function releaseBalloon() {
            const balloon = document.createElement("div");
            balloon.className = "balloon";
            balloon.textContent = "üéà";
            balloon.style.left = Math.random() * 100 + "vw";
            balloon.style.fontSize = (20 + Math.random() * 30) + "px";
            document.body.appendChild(balloon);
            setTimeout(() => balloon.remove(), 6000);
        }

        setInterval(releaseBalloon, 1000);
    </script>
    <script>
        function dropConfetti() {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "vw";
            confetti.style.top = "-10px";
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }

        setInterval(dropConfetti, 200);
    </script>
    <script>
        function dropConfetti() {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "vw";
            confetti.style.top = "-10px";
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }

        setInterval(dropConfetti, 200);
    </script>

</body>

</html>